---
title: "ë‚™ê´€ì  ì—…ë°ì´íŠ¸ì™€ React19 useOptimistic"
description: ë‚™ê´€ì  ì—…ë°ì´íŠ¸ì™€ React 19ì— ìƒˆë¡­ê²Œ ì¶”ê°€ëœ useOptimistic í›…ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ë‹ˆë‹¤.
date: 2025-03-03 05:00:00
toc: true
tags:
  - react
  - optimistic updates
---

í•­í•´ í”„ë¡ íŠ¸ì—”ë“œ 3ê¸° ë™ê¸° ë¶„ë“¤ê³¼ React 19ì— ëŒ€í•´ í•™ìŠµí•˜ëŠ” ìŠ¤í„°ë””ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.<br />
ìŠ¤í„°ë””ë¥¼ ì§„í–‰í•˜ë©° `useOptimistic` í›…ì— ëŒ€í•´ì„œ ì•Œê²Œëœ ë‚´ìš©ì„ ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤.

---

ì´ë¦„ì—ì„œ ìœ ì¶”í•  ìˆ˜ ìˆë“¯ì´ `useOptimistic`ì€ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ ì ìš©í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í›…ì…ë‹ˆë‹¤.<br />
ê·¸ë ‡ë‹¤ë©´ ë‚™ê´€ì  ì—…ë°ì´íŠ¸(Optimistic Updates)ë€ ë¬´ì—‡ì¼ê¹Œìš”?

## ğŸ’¡ ë‚™ê´€ì  ì—…ë°ì´íŠ¸(Optimistic Updates)

ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë€ <b><ins>ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— UIë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒ</ins></b>ì„ ë§í•©ë‹ˆë‹¤.
<b><ins>ìš”ì²­ì´ í•­ìƒ ì„±ê³µí•œë‹¤ê³  ê°€ì •í•˜ê³ , ì‚¬ìš©ìì˜ ì•¡ì…˜ì— ë”°ë¥¸ ê²°ê³¼ë¥¼ ì¦‰ì‹œ UIì— ë°˜ì˜í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ë¹ ë¥¸ í”¼ë“œë°±ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</ins></b><br />

=> ì¸ìŠ¤íƒ€ê·¸ë¨ê³¼ ë²¨ë¡œê·¸ì˜ ì¢‹ì•„ìš” ë²„íŠ¼, ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ìƒí’ˆì˜ ìˆ˜ëŸ‰ì„ ë³€ê²½í•˜ëŠ” ê¸°ëŠ¥ì²˜ëŸ¼ ì‚¬ìš©ìì˜ ì•¡ì…˜ì— ëŒ€í•œ ì¦‰ê°ì ì¸ í”¼ë“œë°±ì„ ì œê³µí•  í•„ìš”ê°€ ìˆì„ ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

ë‚™ê´€ì  ì—…ë°ì´íŠ¸ì˜ í•µì‹¬ ì•„ì´ë””ì–´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. ì‚¬ìš©ì ì•¡ì…˜(ex ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­)
2. **ì‚¬ìš©ìì˜ í™”ë©´ì„ ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ë¡œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸í•œë‹¤.**
3. **í™”ë©´ì´ ë¨¼ì € ì—…ë°ì´íŠ¸ë˜ê³ , ì„œë²„ì— ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.**
4. ì‚¬ìš©ìëŠ” ë³€ê²½ëœ UIë¥¼ ë³´ê¸° ë•Œë¬¸ì—, ë’¤ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì— ëŒ€í•´ì„œ ì¸ì§€í•˜ì§€ ëª»í•œë‹¤.
5. ìš”ì²­ì´ ì™„ë£Œë˜ë©´ ì„œë²„ì˜ ì‘ë‹µìœ¼ë¡œ í™”ë©´ì„ ì—…ë°ì´íŠ¸í•œë‹¤.
6. ìš”ì²­ì´ ì‹¤íŒ¨í–ˆì„ ê²½ìš° ì´ì „ ìƒíƒœë¡œ ë³µì›í•˜ê³ , ì‚¬ìš©ìì—ê²Œ ìš”ì²­ì´ ì‹¤íŒ¨í–ˆë‹¤ëŠ” í”¼ë“œë°±ì„ ì œê³µí•œë‹¤.

---

## (1) `useState`ë¡œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•

ë¨¼ì € `useState`ë¥¼ ì´ìš©í•´ì„œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ êµ¬í˜„í•´ ë´¤ìŠµë‹ˆë‹¤.<br />
í˜„ì¬ ì¢‹ì•„ìš” ìƒíƒœì™€ ê°œìˆ˜ë¥¼ ë³´ì—¬ì£¼ê³ , ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì¢‹ì•„ìš” ì¶”ê°€/ì œê±° apië¥¼ ìš”ì²­í•˜ëŠ” ê°„ë‹¨í•œ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.

```tsx title="LikeButton.tsx" showLineNumbers
import { startTransition } from 'react'
import { Heart } from "lucide-react"
import { addLike, removeLike } from "@/app/services"

interface State {
  isLike: boolean
  count: number
}

function LikeButton() {
  const [state, setState] = useState<State>({ 
    isLike: false,
    count: 0
  })

  const handleClick = async () => {
    const currentState = state
    const nextState = {
      isLike: !currentState.isLike,
      count: currentState.isLike ? currentState.count - 1 : currentState.count + 1
    }

    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸
    setState(nextState)

    try {
      const response = nextState.isLike ? await addLike() : await removeLike()
      // ì„œë²„ ì‘ë‹µ ê²°ê³¼ë¡œ UIë¥¼ ì—…ë°ì´íŠ¸
      setState(response)
      setError('')
    } catch (error) {
      if (error instanceof Error) {
        // ìš”ì²­ì— ì‹¤íŒ¨í–ˆì„ ê²½ìš° ì´ì „ ìƒíƒœë¡œ ë³µì›
        setState(currentState)
        setError(error.message)
      }
    }
  }

  return (
    <button onClick={handleClick}>
      {
        state.isLike ? 
        <Heart color="#d04e4e" fill="#d04e4e" size={80} /> :
        <Heart color="#d04e4e" size={80} />
      }
      <span>{state.count}</span>
    </button>
  )
}
```

- api ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— í˜„ì¬ ìƒíƒœë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ `currentState` ë³€ìˆ˜ë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤. `currentState`ëŠ” ìš”ì²­ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ ë‹¤ì‹œ í˜„ì¬ ìƒíƒœë¡œ ë˜ëŒì•„ê°€ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
- í˜„ì¬ ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚™ê´€ì  ìƒíƒœ(`nextState`)ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
  - `isLike`ë¥¼ ë°˜ëŒ€ ê°’ìœ¼ë¡œ ë³€í™˜
  - ë³€í™˜ëœ `isLike` ê°’ì— ë”°ë¼ `count`ì— +1 ë˜ëŠ” -1ì„ ì ìš©
- `nextState`ë¡œ `setState`ë¥¼ í˜¸ì¶œí•´ì„œ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— ë¨¼ì € ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
- ìš”ì²­ ì„±ê³µ -> ì„œë²„ì˜ ì‘ë‹µ(`response`)ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”ë§í•©ë‹ˆë‹¤.
- ìš”ì²­ ì‹¤íŒ¨ -> `currentState`ë¥¼ ì´ìš©í•´ì„œ ë‹¤ì‹œ ì´ì „ UIë¡œ ë Œë”ë§í•©ë‹ˆë‹¤.

---

## (2) `useOptimistic` í›…ìœ¼ë¡œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•

ë¨¼ì € `useOptimistic`ì˜ êµ¬ì¡°ì™€ ë™ì‘ ë°©ì‹ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

```tsx showLineNumbers
const state: State = { isLike: false, count: 0 }
const [optimisticState, toggleOptimisticIsLike] = useOptimistic<State, State['isLike']>(
  // í›…ì˜ ì´ˆê¸° ìƒíƒœ
  state,
  // updateFn
  (currentState: State, optimisticValue: State['isLike']): State => {
  return {
    isLike: optimisticValue,
    count: optimisticValue ? currentState.count + 1 : currentState.count - 1
  }
})
```

`useOptimistic` í›…ì˜ ë§¤ê°œë³€ìˆ˜

- state
  - í›…ì˜ ì´ˆê¸° ìƒíƒœë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
- updateFn
  - `optimisticState`(ë‚™ê´€ì ì¸ ìƒíƒœ)ë¥¼ ê³„ì‚°í•˜ëŠ” reducer ì—­í• ì„ í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
  - ì‹¤í–‰ë  ë•Œ ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ë¡œ í˜„ì¬ `optimisticState`ì˜ ê°’, ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ë¡œ `toggleOptimisticIsLike` í•¨ìˆ˜ì˜ ì¸ìë¥¼ ì „ë‹¬ë°›ìŠµë‹ˆë‹¤.

`useOptimistic` í›…ì˜ ë¦¬í„´ ê°’

- optimisticState
  - `useOptimistic` í›…ì˜ í˜„ì¬ ìƒíƒœì…ë‹ˆë‹¤.
  - ì•¡ì…˜ì´ pending ìƒíƒœ ê²½ìš° `updateFn` í•¨ìˆ˜ê°€ ë°˜í™˜í•œ ê°’ê³¼ ë™ì¼í•œ ê°’ì„ ê°€ì§‘ë‹ˆë‹¤.
  - ì•¡ì…˜ì´ pending ìƒíƒœê°€ ì•„ë‹ ê²½ìš° ì´ˆê¸° `state`ì™€ ë™ì¼í•œ ê°’(stateê°€ ê°ì²´ì¼ ê²½ìš° ë™ì¼í•œ ì°¸ì¡°)ì„ ê°€ì§‘ë‹ˆë‹¤.
- toggleOptimisticIsLike
  - `optimisticState`ë¥¼ ë³€ê²½í•˜ê¸° ìœ„í•´ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
  - `toggleOptimisticIsLike` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ `updateFn`ì´ í˜¸ì¶œë˜ì–´ `optimisticState`ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
  - í˜¸ì¶œ ì‹œ ì „ë‹¬ ë°›ì€ ì¸ìê°€ `updateFn`ì˜ ë‘ ë²ˆì§¸ ì¸ìë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.

---

ì²˜ìŒ ê³µì‹ ë¬¸ì„œì—ì„œ í›…ì˜ ë§¤ê°œë³€ìˆ˜ì™€ ë¦¬í„´ ê°’ì— ëŒ€í•œ ì„¤ëª…ì„ ì½ì—ˆì„ ë•Œ ì˜ ì´í•´ê°€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br/>
`optimisticState`ì— ëŒ€í•œ ì„¤ëª…ì—ì„œ ì•¡ì…˜, pending ìƒíƒœë€ ë§ì´ ë‚˜ì˜¤ëŠ”ë° ë¬´ìŠ¨ ëœ»ì¼ê¹Œìš”?


```tsx showLineNumbers
const handleClick = () => {
  startTransition(async () => {
    const nextIsLike = !optimisticState.isLike

    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸
    toggleOptimisticIsLike(nextIsLike)

    // ì•„ì£¼ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…
    await new Promise<void>((resolve) => {
			setTimeout(resolve, 10000)
		})
  })
}
```

ìœ„ ì½”ë“œì—ì„œ `startTransition`ì˜ ì¸ìë¡œ ì „ë‹¬ë˜ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ "ì•¡ì…˜"ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.<br />
[`startTransition`](https://react.dev/reference/react/startTransition)ì€ UI ë Œë”ë§ì„ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” apiì…ë‹ˆë‹¤.

ì•¡ì…˜ ë‚´ë¶€ì—ì„œ `toggleOptimisticIsLike` í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´, `updateFn`ì´ ì‹¤í–‰ë˜ê³  `updateFn`ì´ ë°˜í™˜í•œ ê°’ìœ¼ë¡œ `optimisticState`ê°€ ë³€ê²½ë©ë‹ˆë‹¤.<br />
`optimisticState`ì€ 10ì´ˆ ë’¤ promiseê°€ resolveë˜ì–´ ì•¡ì…˜ í•¨ìˆ˜ì˜ ì‹¤í–‰ì´ ì¢…ë£Œë  ë•Œ ê¹Œì§€ ìœ ì§€ë©ë‹ˆë‹¤.<br />
ì•¡ì…˜ í•¨ìˆ˜ì˜ ì‹¤í–‰ì´ ì¢…ë£Œë˜ë©´, `useOptimistic` í›…ì€ `optimisticState`ì˜ ê°’ì„ ë‹¤ì‹œ ì´ˆê¸° ê°’ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.

ì •ë¦¬í•˜ë©´, **ì•¡ì…˜ì´ ì‹¤í–‰ ì¤‘ì¸ ìƒíƒœë¥¼ pending ìƒíƒœë¼ê³  ë¶€ë¥´ê³ , ë‚™ê´€ì ì¸ ìƒíƒœ(`optimisticState`)ëŠ” ì•¡ì…˜ì´ pending ìƒíƒœì¸ ë™ì•ˆ ìœ ì§€ë©ë‹ˆë‹¤.**<br />
ì•¡ì…˜ì˜ ì‹¤í–‰ì´ ì¢…ë£Œë˜ë©´ ì´ˆê¸° ìƒíƒœë¡œ ëŒì•„ê°€ëŠ” `useOptimistic` í›…ì˜ ë™ì‘ ë°©ì‹ ë•Œë¬¸ì— ìš”ì²­ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ ì´ˆê¸° ìƒíƒœë¡œ ì‰½ê²Œ ë˜ëŒë¦¬ëŠ” ë¡œì§ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />

=> ì—¬ê¸°ì„œ ì£¼ì˜í•  ì ì´ ìˆìŠµë‹ˆë‹¤.<br/>
ì•¡ì…˜ ë‚´ë¶€ì—ì„œ í˜¸ì¶œí•œ api ìš”ì²­ì´ ì„±ê³µí•˜ë”ë¼ë„ `useOptimistic` í›…ì˜ ì´ˆê¸° ìƒíƒœë¥¼ ë³€ê²½í•˜ì§€ ì•Šìœ¼ë©´ `optimisticState`ëŠ” í•­ìƒ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒì•„ê°‘ë‹ˆë‹¤.<br />
ë”°ë¼ì„œ, api ìš”ì²­ í›„ ë‚™ê´€ì ì¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ **apiì˜ ì‘ë‹µì„ `useOptimistic` í›…ì˜ ì´ˆê¸° ìƒíƒœì™€ ë™ê¸°í™”í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.**

---

### 1ï¸âƒ£ `useState`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ê¸°í™”í•˜ëŠ” ë°©ë²•

- `useState`ê°€ ë°˜í™˜í•œ stateë¥¼ `useOptimistic` í›…ì˜ ì´ˆê¸° ìƒíƒœë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
- `setState`ê°€ í˜¸ì¶œë˜ì–´ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ë•Œë§ˆë‹¤ `useOptimistic`ì´ ìƒˆë¡œìš´ ì´ˆê¸° ìƒíƒœì™€ í•¨ê»˜ í˜¸ì¶œë©ë‹ˆë‹¤.
- api ìš”ì²­ì— ì„±ê³µí•  ê²½ìš°
  - ì„œë²„ì˜ ì‘ë‹µìœ¼ë¡œ setStateë¥¼ í˜¸ì¶œí•˜ê³ , ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ ë©ë‹ˆë‹¤.
  - `useOptimistic`ì´ ìƒˆë¡œìš´ ì´ˆê¸° ìƒíƒœ(state)ì™€ í•¨ê»˜ í˜¸ì¶œë˜ì–´ ë‚™ê´€ì ì¸ ìƒíƒœë¡œ ì—…ë°ì´íŠ¸ëœ í™”ë©´ì´ ìœ ì§€ë©ë‹ˆë‹¤.
- api ìš”ì²­ì— ì‹¤íŒ¨í•  ê²½ìš°
  - `setError`ê°€ í˜¸ì¶œë˜ì–´ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë©ë‹ˆë‹¤.
  - `useOptimistic`ì˜ ì´ˆê¸° ìƒíƒœê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— `optimisticState`ê°€ ë‹¤ì‹œ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒì•„ê°€ê³ , ì‚¬ìš©ì ì•¡ì…˜ ì´ì „ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.

```tsx title="LikeButton.tsx" showLineNumbers
import { startTransition } from 'react'
import { Heart } from "lucide-react"
import { addLike, removeLike } from "@/app/services"

interface State {
  isLike: boolean
  count: number
}

type Value = State['isLike']

function LikeButton() {
  const [state, setState] = useState<State>({ 
    isLike: false,
    count: 0
  })

  const [optimisticState, toggleOptimisticIsLike] = useOptimistic<State, Value>(
  state,
  (currentState: State, optimisticValue: Value): State => {
    return {
      isLike: optimisticValue,
      count: optimisticValue ? currentState.count + 1 : currentState.count - 1
    }
  })

  const handleClick = () => {
    startTransition(async () => {
      const nextIsLike = !optimisticState.isLike

      // ë‚™ê´€ì  ì—…ë°ì´íŠ¸
      toggleOptimisticIsLike(nextIsLike)

      try {
        const response = nextIsLike ? await addLike() : await removeLike()

        // ì„œë²„ ì‘ë‹µ ê²°ê³¼ë¡œ UIë¥¼ ì—…ë°ì´íŠ¸
        setState(response)
        setError('')
      } catch (error) {
        if (error instanceof Error) {
          setError(error.message)
        }
      }
    })
  }

  return (
    <button onClick={handleClick}>
      {
        optimisticState.isLike ? 
        <Heart color="#d04e4e" fill="#d04e4e" size={80} /> :
        <Heart color="#d04e4e" size={80} />
      }
      <span>{optimisticState.count}</span>
    </button>
  )
}
```

=> ì‚¬ìš©ìì˜ í™”ë©´ì—ëŠ” api ìš”ì²­ ê²°ê³¼ì— ë”°ë¼ ì´ë ‡ê²Œ ë³´ì—¬ì§‘ë‹ˆë‹¤ ğŸ‘

![](/posts/react-use-optimistic/example-2.gif)*API ìš”ì²­ì— ì„±ê³µí–ˆì„ ê²½ìš°*

![](/posts/react-use-optimistic/example-3.gif)*API ìš”ì²­ì— ì‹¤íŒ¨í–ˆì„ ê²½ìš°*

---

### 2ï¸âƒ£ `props`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ê¸°í™”í•˜ëŠ” ë°©ë²•

- ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ë¡œë¶€í„° ì „ë‹¬ë°›ì€ `props`ë¥¼ `useOptimistic`ì˜ ì´ˆê¸° ê°’ìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
- ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì˜ stateê°€ ë³€ê²½ë˜ë©´, `LikeButton` ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ì‹œ ë¦¬ë Œë”ë§ë˜ê³ , `useOptimistic` í›…ì´ ìƒˆë¡œìš´ ì´ˆê¸° ìƒíƒœì™€ í•¨ê»˜ í˜¸ì¶œë©ë‹ˆë‹¤.

```tsx showLineNumbers
// page.tsx
import { useEffect, useState } from "react"
import LikeButton from "@/app/LikeButton"
import { getLike, addLike, removeLike } from "@/app/services"

interface State {
  isLike: boolean
  count: number
}

export default function Home() {
  const [state, setState] = useState<State>({ 
    isLike: false,
    count: 0
  })

  const [error, setError] = useState('')

  useEffect(() => {
    const fetchData = async () => {
      const response = await getLike()
      setState(response)
    }

    fetchData();
  }, [])

  const toggleAction = async (isLike: boolean) => {
    try {
      const response = isLike ? await addLike() : await removeLike()
      setState(response)
      setError('')
    } catch (error) {
      if (error instanceof Error) {
        setError(error.message)
      }
    }
  }

  return (
    <div>
      <LikeButton 
        count={state.count}
        isLike={state.isLike}
        error={error}
        toggleAction={toggleAction} 
      />
    </div>
  );
}
```

```tsx title="LikeButton.tsx" showLineNumbers
interface Props {
  isLike: boolean
  count: number
  error: string
  toggleAction: (isLike: boolean) => Promise<void>
}

export default function LikeButton({ count, isLike, error, toggleAction }: Props) {
  // propsë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ì‚¬ìš©
  const [optimisticState, toggleOptimisticIsLike] = useOptimistic<State, State['isLike']>({
    count,
    isLike
  }, (currentState, optimisticValue) => {
    return {
      isLike: optimisticValue,
      count: optimisticValue ? currentState.count + 1 : currentState.count - 1
    }
  })

  const [isPending, startTransition] = useTransition()

  const handleClick = () => {
    startTransition(async () => {
      const nextIsLike = !optimisticState.isLike

      // ë‚™ê´€ì  ì—…ë°ì´íŠ¸
      toggleOptimisticIsLike(nextIsLike)
      
      await toggleAction(nextIsLike)
    })
  }

  return (
    <button onClick={handleClick}>
      {
        optimisticState.isLike ? 
        <Heart color="#d04e4e" fill="#d04e4e" size={80} /> :
        <Heart color="#d04e4e" size={80} />
      }
      <span>{optimisticState.count}</span>
    </button>
  )
}
```

---

## ìš”ì•½

- ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë€ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— UIë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ë¹ ë¥´ê²Œ í”¼ë“œë°±ì„ ì œê³µí•˜ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤.
- React 19ì— ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ `useOptimistic` í›…ì´ ìƒˆë¡­ê²Œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

**`useOptimistic` í›…ì˜ ì¥ì **
- Reactì— ë‚´ì¥ëœ í›…ì´ë¯€ë¡œ ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ì—†ì´ ê°€ë³ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì´ˆê¸° ìƒíƒœë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì—¬, api ìš”ì²­ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ ì‰½ê²Œ ì´ˆê¸° ìƒíƒœë¡œ ë¡¤ë°±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**`useOptimistic` í›…ì˜ ë‹¨ì **
- ì„œë²„ ìƒíƒœì™€ `useOptimistic` í›…ì˜ ì´ˆê¸° ìƒíƒœë¥¼ ë™ê¸°í™”í•˜ëŠ” ì¶”ê°€ì ì¸ ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.
- **`toggleOptimisticIsLike` í•¨ìˆ˜ëŠ” ë°˜ë“œì‹œ React Form Actionê³¼ startTransition í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.** ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš° ì•„ë˜ **ì—ëŸ¬ ë©”ì‹œì§€**ê°€ ì½˜ì†”ì— ì¶œë ¥ë©ë‹ˆë‹¤.
> "An optimistic state update occurred outside a transition or action. To fix, move the update to an action, or wrap with startTransition."

---

ì „ì²´ ì½”ë“œëŠ” [ì €ì¥ì†Œ](https://github.com/kyh196201/react-useOptimistic-example/blob/main/app/LikeButton.tsx)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ëª»ëœ ë‚´ìš©ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”¼ë“œë°±ì€ ì–¸ì œë‚˜ í™˜ì˜ì…ë‹ˆë‹¤! ğŸ™‚

---

## ì°¸ê³ 

- https://react.dev/reference/react/useOptimistic
- https://medium.com/@kyledeguzmanx/what-are-optimistic-updates-483662c3e171
- [https://velog.io/@kimkanu/React-í›…-useOptimistic](https://velog.io/@kimkanu/React-%ED%9B%85-useOptimistic)
- [https://velog.io/@jhjung3/Optimistic-Updates-êµ¬í˜„í•˜ê¸°-with-ë¦¬ì•¡íŠ¸-ì¿¼ë¦¬](https://velog.io/@jhjung3/Optimistic-Updates-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-with-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%BF%BC%EB%A6%AC)