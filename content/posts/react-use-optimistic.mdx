---
title: "React19 - useOptimistic hookê³¼ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê¸°"
date: 2025-01-31 23:30:00
toc: true
tags:
  - vite
  - env
---

# React 19 ê³µì‹ë¬¸ì„œ ì½ì–´ë³´ê¸°

í•­í•´ê°€ ëë‚˜ê³  ìƒˆë¡œìš´ ê¸°ìˆ  ìŠ¤í„°ë””ë¥¼ ì§„í–‰í•˜ê²ŒëìŠµë‹ˆë‹¤.
í‰ì†Œ íšŒì‚¬ì—ì„œëŠ” vueë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë¦¬ì•¡íŠ¸ì˜ ìƒˆë¡œìš´ ê¸°ëŠ¥ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê³  ì‹¶ì—ˆê³ , ë˜ ì´ë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ ì¸ì‚¬ì´íŠ¸ë¥¼ ì–»ê¸° ìœ„í•´ì„œ ê³µì‹ë¬¸ì„œë¥¼ í†µí•´ ìƒˆë¡­ê²Œ ë‚˜ì˜¨ ê¸°ìˆ ì— ëŒ€í•´ì„œ í•™ìŠµí•´ë³´ëŠ” ì‹œê°„ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤.

ì—¬ëŸ¬ hookì´ ìƒˆë¡œ ì¶”ê°€ëì§€ë§Œ ê·¸ ì¤‘ì—ì„œë„ `useOptimistic`ì— ëŒ€í•´ì„œ ìì„¸í•˜ê²Œ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤.

## ë‚™ê´€ì  ì—…ë°ì´íŠ¸(Optimistic Updates)ë€?

ì„œë²„ì˜ ì‘ë‹µì´ ë„ì°©í•˜ê¸° ì „ì— ì‚¬ìš©ìì˜ í™”ë©´ì„ ë¨¼ì € ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ë¡œ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤.("ë‚´ê°€ ì˜ˆìƒí•œëŒ€ë¡œ ì‘ë‹µì´ ì˜¬ê±°ì•¼!"ë¼ëŠ” ë‚™ê´€ì ì¸ ê¸°ëŒ€ë¥¼ ê°€ì§€ê³  ë¯¸ë¦¬ í´ë¼ì´ì–¸íŠ¸ì˜ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒ!)
ë”°ë¼ì„œ, ì‚¬ìš©ìëŠ” ë™ì‘ì— ëŒ€í•œ í”¼ë“œë°±ì„ ë¹¨ë¦¬ ë°›ì„ ìˆ˜ ìˆê²Œë˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¹ ë¥´ê²Œ ë™ì‘í•œë‹¤ê³  ëŠë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‚™ê´€ì  ì—…ë°ì´íŠ¸ì˜ í•µì‹¬ ì•„ì´ë””ì–´

1. ì‚¬ìš©ì ì•¡ì…˜(ex ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­)
2. ë²„íŠ¼ í´ë¦­ê³¼ ë™ì‹œì— ì‚¬ìš©ìì˜ í™”ë©´ì„ ì—…ë°ì´íŠ¸
3. ìš”ì²­ì´ ì‹¤íŒ¨í•  ê²½ìš° ì´ì „ ìƒíƒœë¡œ ë‹¤ì‹œ ëŒì•„ê°€ê±°ë‚˜ ì–¼ëŸ¿ ë©”ì‹œì§€ë¥¼ ì œê³µí•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ìš”ì²­ì´ ì‹¤íŒ¨í–ˆë‹¤ëŠ” í”¼ë“œë°±ì„ ì œê³µ

ì•„ë˜ëŠ” ë‚™ê´€ì  ì—…ë°ì´íŠ¸ì— ëŒ€í•œ ì§€ì‹ì´ ì—†ì„ ë•Œ ì œê°€ ì—…ë¬´ë¥¼ í•˜ë©´ì„œ êµ¬í˜„í•œ ê´€ì‹¬ ë¸Œëœë“œ ì¶”ê°€/ì œê±° ê¸°ëŠ¥ì…ë‹ˆë‹¤.
ì½”ë“œì˜ ë™ì‘ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. ê´€ì‹¬ ë¸Œëœë“œì¼ ê²½ìš° ê´€ì‹¬ ë¸Œëœë“œì—ì„œ ì œê±°í•˜ëŠ” APIë¥¼ ìš”ì²­
2. ê´€ì‹¬ ë¸Œëœë“œê°€ ì•„ë‹ ê²½ìš° ê´€ì‹¬ ë¸Œëœë“œì— ì¶”ê°€í•˜ëŠ” APIë¥¼ ìš”ì²­
3. API ì‘ë‹µì´ ë„ì°©í•˜ë©´ ì‚¬ìš©ìì˜ í™”ë©´ì„ ì—…ë°ì´íŠ¸
4. ì´ë•Œ, API ìš”ì²­ì´ ì§„í–‰ì¤‘ì¸ ë™ì•ˆ ì‚¬ìš©ìê°€ ì¶”ê°€ì ìœ¼ë¡œ ë²„íŠ¼ì„ í´ë¦­í•  ê²½ìš° ë¬´ì‹œ

ì‚¬ìš©ìëŠ” ë²„íŠ¼ì„ í´ë¦­í•œ í›„ ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ê³  API ì‘ë‹µì´ ë„ì°©í•œ í›„ì— ì¢‹ì•„ìš” ë²„íŠ¼ì´ ë³€ê²½ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// í˜„ì¬ ì ‘ì†í•œ ë¸Œëœë“œì˜ Id
const brandId = route.params.brandId;
// ì¢‹ì•„ìš” ì—¬ë¶€
const isLiked = ref(false);
// í˜„ì¬ ì¢‹ì•„ìš” ê°œìˆ˜
const likeCount = ref(0);
// API ìš”ì²­ì¤‘ì¸ì§€ ì²´í¬í•˜ê¸° ìœ„í•œ pending ë³€ìˆ˜
const isPending = ref(false);

const addLike = () => {
	return Api.addLike(brandId.value)
	.then((response) => {
		isLiked.value = true;
		likeCount.value = response.likeCount;
	}).catch((error) => {
		console.error('addLike failed: ', error)
	});
};

const removeLike = () => {
	return Api.removeLike(brandId.value)
	.then((response) => {
		isLiked.value = false;
		likeCount.value = response.likeCount;
	}).catch((error) => {
		console.error('removeLike failed: ', error)
	});
}

const handleLike = async () => {
	if (isPending.value) return;

	isPending.value = true;

	if (isLiked.value) {
		await removeLike();
	} else {
		await addLike();
	}

	isPending.value = false;
};
```


ë‚™ê´€ì  ì—…ë°ì´íŠ¸ê°€ ì ìš©ëœ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```tsx
const addLike = () => {
	// í˜„ì¬ ìƒíƒœë¥¼ ì €ì¥
	const prevIsLike = isLiked.value;
	const prevLikeCount = likeCount.value;

	// ğŸ’¡ Optimistic Updates
	// ê¸°ëŒ€ë˜ëŠ” ê²°ê³¼ì— ë§ê²Œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸
	isLiked.value = true;
	likeCount.value += 1;

	return Api.addLike(brandId.value)
	.then((response) => {
		likeCount.value = response.likeCount;
	}).catch((error) => {
		console.error('addLike failed: ', error);

		// ğŸ’¡ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì´ì „ ìƒíƒœë¡œ ë³µì›
		isLiked.value = prevIsLike;
		likeCount.value = prevLikeCount;
	});
};

const removeLike = () => {
	const prevIsLike = isLiked.value;
	const prevLikeCount = likeCount.value;

	// ğŸ’¡ Optimistic Updates
	isLiked.value = false;
	likeCount.value -= 1;

	return Api.removeLike(brandId.value)
	.then(() => {
		likeCount.value = response.likeCount;
	}).catch((error) => {
		console.error('removeLike failed: ', error);

		// ğŸ’¡ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì´ì „ ìƒíƒœë¡œ ë³µì›
		isLiked.value = prevIsLike;
		likeCount.value = prevLikeCount;
	});
}
```

---

## React19 useOptimistic í›…

ë¦¬ì•¡íŠ¸ 19 ë²„ì „ë¶€í„° ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” `useOptimistic` í›…ì´ ìƒˆë¡­ê²Œ ì¶”ê°€ëìŠµë‹ˆë‹¤.

ë¦¬ì•¡íŠ¸ ê³µì‹ ë¬¸ì„œì—ì„œëŠ” `useOptimistic` í›…ì„ ë¹„ë™ê¸° ì‘ì—…ì´ ì§„í–‰ ì¤‘ì¼ ë•Œ ë‹¤ë¥¸ ìƒíƒœë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í›…ì´ë¼ê³  ì†Œê°œí•˜ê³  ìˆìŠµë‹ˆë‹¤.(`useOptimistic` is a React Hook that lets you show a different state while an async action is underway)

ê³µì‹ ë¬¸ì„œì˜ ì„¤ëª…ë§Œ ì½ì—ˆì„ ë•ŒëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì´í•´ê°€ ë˜ì§€ ì•Šì•˜ê³ , ë™ì‘ ë°©ì‹ì„ í™•ì¸í•˜ê¸° ìœ„í•´ Velog ê²Œì‹œê¸€ ì¢‹ì•„ìš” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì¢‹ì•„ìš” ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

ë¨¼ì €, ë‚™ê´€ì ì¸ ìƒíƒœë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ `useOptimistic` í›…ì„ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— í˜¸ì¶œí•©ë‹ˆë‹¤.

```tsx
interface State {
	isLike: boolean
	count: number
}

type Value = State['isLike']

function LikeButton() {
	const state = { 
		isLike: false,
		count: 0
	}
	
	const updateFn = (currentState: State, optimisticValue: Value): State => {
		return {
			isLike: optimisticValue,
			count: optimisticValue ? currentState.count + 1 : currentState.count - 1
		}
	}

	// useOptimistic í›… í˜¸ì¶œ
	const [optimisticState, toggleOptimisticIsLike] = useOptimistic<State, Value>(
		// 1. ì´ˆê¸° ìƒíƒœ
		state,
		// 2. ë‚™ê´€ì ì¸ ìƒíƒœ
		updateFn
	)
	
	return (
		// UI ìƒëµ...
	)
}
```

`useOptimistic` í›…ì˜ íŒŒë¼ë¯¸í„°

- state
    - ì´ˆê¸° ìƒíƒœì— í•´ë‹¹í•˜ëŠ” ê°’ì…ë‹ˆë‹¤.
- updateFn
    - í˜„ì¬ ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¹„ë™ê¸° ì•¡ì…˜ì´ ì§„í–‰ ì¤‘ì¸ ë™ì•ˆ(pending ìƒíƒœì¼ ë•Œ) í™”ë©´ì— ë³´ì—¬ì¤„ ë‚™ê´€ì ì¸ ìƒíƒœë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
    - `toggleOptimisticIsLike` í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ `useOptimistic` ë‚´ë¶€ì˜ í˜„ì¬ ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ `updateFn`ì„ ì‹¤í–‰í•˜ì—¬ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

`useOptimistic` í›… ë°˜í™˜ ê°’

- optimisticState
    - ë¹„ë™ê¸° ì•¡ì…˜ì´ ì§„í–‰ ì¤‘ì¸ ë™ì•ˆ í™”ë©´ì— ë³´ì—¬ì§ˆ ìƒíƒœì…ë‹ˆë‹¤.
    - `updateFn`ì´ ë°˜í™˜í•œ ê°’ê³¼ ë™ì¼í•©ë‹ˆë‹¤.
    - ë¹„ë™ê¸° ì•¡ì…˜ì´ ì¢…ë£Œë˜ë©´ ì´ˆê¸° `state`ë¡œ ë˜ëŒì•„ê°‘ë‹ˆë‹¤.
- toggleOptimisticIsLike
    - `optimisticState`ë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•´ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
    - í˜¸ì¶œ ì‹œ ì „ë‹¬ë°›ì€ íŒŒë¼ë¯¸í„°ê°€ `updateFn`ì˜ ë‘ ë²ˆì§¸ ì¸ìë¡œ ì „ë‹¬ë˜ê³ , ì´ ê°’ì€ `updateFn`ì´ ìƒˆë¡œìš´ ìƒíƒœë¥¼ ê³„ì‚°í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

---

`toggleOptimisticIsLike` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ë¹„ë™ê¸° ì•¡ì…˜ì´ ì§„í–‰ì¤‘ì¸ ë™ì•ˆ ë‹¤ë¥¸ ìƒíƒœ(ë‚™ê´€ì  ìƒíƒœ)ë¥¼ ë³´ì—¬ì£¼ê¸°

```tsx
import { useOptimistic, startTransition } from "react";

function LikeButton() {
	// useOptimistic í˜¸ì¶œ ìƒëµ..
	
	const handleClick = () => {
		// 1. 
		startTransition(async () => {
			// 2. ğŸ’¡ Optimistic Updates
			toggleOptimisticIsLike(!optimisticState.isLike)
	
			// 3. API ìš”ì²­ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ê¸° ìœ„í•´ 2ì´ˆì˜ ì§€ì—° ì„¤ì •
			await new Promise<void>((resolve) => {
				setTimeout(resolve, 2000)
			})
		})
	}
	
	const heartIcon = optimisticState.isLike ? <Heart color="#d04e4e" fill="#d04e4e" size={80} /> : <Heart color="#d04e4e" size={80} />
	
	return (
		<button type="button" className="flex flex-col gap-2 justify-center items-center" onClick={handleClick}>
			{heartIcon}
			<span className="text-4xl text-center text-slate-600 font-semibold">{optimisticState.count}</span>
		</button>
	)
}
```

1. ë¹„ë™ê¸° ì•¡ì…˜ ë‚´ë¶€ì—ì„œ `toggleOptimisticIsLike` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ì„œ `startTransition`ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. 
    1. `startTransition` ì˜ ì¸ìë¡œ ì „ë‹¬í•˜ëŠ” í•¨ìˆ˜ë¥¼ Actionì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.
        1. https://ko.react.dev/reference/react/useTransition#functions-called-in-starttransition-are-called-actions
        2. https://ko.react.dev/blog/2024/12/05/react-19#by-convention-functions-that-use-async-transitions-are-called-actions
    2. `startTransition`ì˜ Actionì´ í˜¸ì¶œë˜ëŠ” ë™ì•ˆì€ `pending` ìƒíƒœê°€ ìœ ì§€ë˜ê³ , ì´ ì‹œê°„ ë™ì•ˆ `updateFn` í•¨ìˆ˜ê°€ ë°˜í™˜ëœ ê°’ì´ `optimisticState`ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
2. ë‚™ê´€ì ì¸ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•´ `toggleOptimisticIsLike` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. í˜„ì¬ ì¢‹ì•„ìš” ìƒíƒœì™€ ë°˜ëŒ€ë˜ëŠ” ê°’ì„ ì¸ìë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
    1. `updateFn` ì˜ `optimisticValue`ë¡œ `true`ê°€ ì „ë‹¬ë˜ê³ , `optimisticState.count`ê°€ 1 ì¦ê°€í•©ë‹ˆë‹¤.
    
    ```tsx
    const updateFn = (currentState: State, optimisticValue: Value): State => {
    	return {
    		// 1. optimisticValueê°€ trueë¡œ í˜¸ì¶œ
    		isLike: optimisticValue,
    		// 2. ë³€ê²½í•˜ê³ ì í•˜ëŠ” ìƒíƒœê°€ ì¢‹ì•„ìš” ìƒíƒœì¼ ê²½ìš° ì¢‹ì•„ìš” ê°œìˆ˜ 1 ì¦ê°€, 
    		// ì¢‹ì•„ìš” í•´ì œì¼ ê²½ìš° ê°œìˆ˜ 1 ê°ì†Œëœ ìƒíƒœë¥¼ ë°˜í™˜
    		count: optimisticValue ? currentState.count + 1 : currentState.count - 1
    	}
    }
    ```
    
3. ì•¡ì…˜ì´ í˜¸ì¶œë˜ëŠ” ë™ì•ˆ ë‚™ê´€ì ì¸ ìƒíƒœê°€ í™”ë©´ì— ë³´ì—¬ì§€ëŠ” ê²ƒì„ í™•ì¸í•˜ê¸° ìœ„í•´ 2ì´ˆì˜ ì§€ì—°ì„ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.

<details>
<summary>ì „ì²´ ì½”ë“œ</summary>

```tsx
import { Heart } from "lucide-react";
import { useOptimistic, startTransition } from "react";

interface State {
	isLike: boolean
	count: number
}

export default function LikeButton() {
	const [optimisticState, toggleOptimisticIsLike] = useOptimistic<State, State['isLike']>({ 
		isLike: false,
		count: 0
	}, (currentState, optimisticValue) => {
		return {
			isLike: optimisticValue,
			count: optimisticValue ? currentState.count + 1 : currentState.count - 1
		}
	})

	const handleClick = () => {
		startTransition(async () => {
			toggleOptimisticIsLike(!optimisticState.isLike)

			// ë¹„ë™ê¸° ì•¡ì…˜ì´ ë°”ë¡œ ì¢…ë£Œë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ 2ì´ˆ ì§€ì—° ì¶”ê°€
			await new Promise<void>((resolve) => {
				setTimeout(resolve, 2000)
			})
		})
	}

	const heartIcon = optimisticState.isLike ? <Heart color="#d04e4e" fill="#d04e4e" size={80} /> : <Heart color="#d04e4e" size={80} />

	return (
		<button type="button" className="flex flex-col gap-2 justify-center items-center" onClick={handleClick}>
			{heartIcon}
			<span className="text-4xl text-center text-slate-600 font-semibold">{optimisticState.count}</span>
		</button>
	)
}
```
</details>


ì‚¬ìš©ìì˜ í™”ë©´ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë…¸ì¶œë©ë‹ˆë‹¤.

![](/posts/react-use-optimistic/example-1.gif)*ë‚™ê´€ì  ì—…ë°ì´íŠ¸ê°€ ì ìš©ëœ í›„ ë‹¤ì‹œ ì´ˆê°€ ìƒíƒœë¡œ ë˜ëŒì•„ê°€ëŠ” ëª¨ìŠµ*

`useOptimistic`ë§Œ ë‹¨ë…ìœ¼ë¡œ ì‚¬ìš©í•  ê²½ìš° ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ë•Œ ë§ˆë‹¤ ì´ˆê¸° ìƒíƒœ(state)ê°€ ë™ì¼í•˜ë¯€ë¡œ, í•­ìƒ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒì•„ê°€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œ APIë¥¼ ìš”ì²­ í›„ ë³€ê²½ëœ ìƒíƒœë¥¼ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ì„œëŠ” `useOptimistic`ì˜ ì´ˆê¸° ìƒíƒœë¥¼ ì„œë²„ ìƒíƒœì™€ ë™ê¸°í™”í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.

ì„œë²„ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `useState` ì¶”ê°€í•˜ê³ , ì‹¤ì œ ì„œë¹„ìŠ¤ì²˜ëŸ¼ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

```tsx
function LikeButton() {
	// 1. ì„œë²„ ìƒíƒœì™€ ë™ê¸°í™”í•˜ê¸° ìœ„í•´ state ì„ ì–¸
	const [state, setState] = useState<State>({ 
		isLike: false,
		count: 0
	})
	
	const [error, setError] = useState('')
	
	const updateFn = () => ({
		// ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼
	});
	
	// useOptimistic í›…ì€ stateê°€ ë³€ê²½ë˜ì–´ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë˜ì§€ ì•Šìœ¼ë©´,
	// ì´ˆê¸° ìƒíƒœë¥¼ ê³„ì† ìœ ì§€
	const [optimisticState, toggleOptimisticIsLike] = useOptimistic<State, Value>(state, updateFn)
	
	// 2. pending ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•´ useTransition í›… í˜¸ì¶œ
	const [isPending, startTransition] = useTransition()

	// 3. POST API ìš”ì²­
	const addLike = async () => {
		try {
			const response = await fetch('/api/like', { method: 'POST' })
			if (!response.ok) {
				throw new Error('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
			}
			const data = (await response.json()) as { isLike: boolean; count: number }
			
			// 3-1 API ìš”ì²­ì— ì„±ê³µí–ˆì„ ê²½ìš° ì„œë²„ ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ë§
			setState(data)
		} catch (error) {
			if (error instanceof Error) {
				// 3-2 API ìš”ì²­ì— ì‹¤íŒ¨í–ˆì„ ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ë Œë”ë§
				// stateê°€ ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— optimisticStateê°€ ì´ˆê¸° ìƒíƒœë¡œ ë¡¤ë°±
				setError(error.message)
			}
		}
	}
	
	const removeLike = async () => {
		const response = await fetch('/api/like', { method: 'DELETE' })
		const data = (await response.json()) as { isLike: boolean; count: number }
		setState(data)
	}
	
	const handleClick = () => {
		startTransition(async () => {
			const nextIsLike = !optimisticState.isLike
			
			// ğŸ’¡ Optimistic Updates
			toggleOptimisticIsLike(nextIsLike)
	
			// 3. ë‹¤ìŒ ì¢‹ì•„ìš” ìƒíƒœì— ë”°ë¼ì„œ API í˜¸ì¶œ
			if (nextIsLike === true) {
				await addLike()
			} else {
				await removeLike()
			}
		})
	}
	
	return (
		<button type="button" className="flex flex-col gap-2 justify-center items-center" onClick={handleClick}>
			{heartIcon}
			<span className="text-4xl text-center text-slate-600 font-semibold">{optimisticState.count}</span>
			{/* ë¹„ë™ê¸° ì•¡ì…˜ì´ ì§„í–‰ì¤‘ì¸ ë™ì•ˆ loading í…ìŠ¤íŠ¸ í‘œì‹œ */}
			{isPending && <div className="text-2xl text-center text-slate-600">loading...</div>}
			{error && <div className="text-2xl text-center text-red-600">{error}</div>}
		</button>
	)
}
```

1. `useState`ê°€ ë°˜í™˜í•œ stateë¥¼ `useOptimistic`ì˜ ì´ˆê¸° ê°’ìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
    - `setState`ê°€ í˜¸ì¶œë˜ì–´ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë˜ë©´, `useOptimistic`ì´ ìƒˆë¡œìš´ `state`ì™€ í˜¸ì¶œë˜ì–´ ì´ˆê¸° ìƒíƒœê°€ ë³€ê²½ë©ë‹ˆë‹¤.
2. API ì‘ë‹µì´ ë„ì°©í•˜ê¸° ì „ì— ë‚™ê´€ì ì¸ ìƒíƒœê°€ ë¨¼ì € ì—…ë°ì´íŠ¸ë˜ê³ , í™”ë©´ì— ë Œë”ë§ë˜ëŠ” ê²ƒì„ í™•ì¸í•˜ê¸° ìœ„í•´ `useTransition` í›…ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.
    - `pending` ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `useTransition` í›…ì´ ë°˜í™˜í•˜ëŠ” `startTransition`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    - `startTransition`ì˜ ì•¡ì…˜ì´ í˜¸ì¶œë˜ëŠ” ë™ì•ˆ  `isPending` ì´ `true`ë¡œ ìœ ì§€ë˜ê³ ,  â€œloading...â€ í…ìŠ¤íŠ¸ë¥¼ í™”ë©´ì— ë Œë”ë§ë©ë‹ˆë‹¤.
3. `toggleOptimisticIsLike` ì„ í˜¸ì¶œí•˜ì—¬ ë‚™ê´€ì ì¸ ìƒíƒœë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸í•œ í›„, APIë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.
    - 3-1) API ìš”ì²­ì— ì„±ê³µí•  ê²½ìš° `setState`ê°€ í˜¸ì¶œë˜ê³ , ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë©ë‹ˆë‹¤.
    - 3-2) API ìš”ì²­ì— ì‹¤íŒ¨í•  ê²½ìš° `optimisticState`ê°€ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒì•„ê°‘ë‹ˆë‹¤.
4. API í˜¸ì¶œì— ì‹¤íŒ¨í•  ê²½ìš° ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤ë‹ˆë‹¤.

ì‚¬ìš©ìì˜ í™”ë©´ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë Œë”ë§ë©ë‹ˆë‹¤.

![](/posts/react-use-optimistic/example-2.gif)*API ìš”ì²­ì— ì„±ê³µí–ˆì„ ê²½ìš°*

![](/posts/react-use-optimistic/example-3.gif)*API ìš”ì²­ì— ì‹¤íŒ¨í–ˆì„ ê²½ìš°*

<details>
<summary>ì „ì²´ ì½”ë“œ</summary>

```tsx
import { Heart } from "lucide-react";
import { useOptimistic, useTransition, useState, useEffect } from "react";

interface State {
	isLike: boolean
	count: number
}

export default function LikeButton() {
	const [state, setState] = useState<State>({ 
		isLike: false,
		count: 0
	})

	const [error, setError] = useState('')

	const [optimisticState, toggleOptimisticIsLike] = useOptimistic<State, State['isLike']>(state, (currentState, optimisticValue) => {
		return {
			isLike: optimisticValue,
			count: optimisticValue ? currentState.count + 1 : currentState.count - 1
		}
	})

	const [isPending, startTransition] = useTransition()

	useEffect(() => {
		const fetchData = async () => {
			const response = await fetch('/api/like', { method: 'GET' })
			const data = (await response.json()) as { isLike: boolean; count: number }
			setState(data)
		}

		fetchData();
	}, [])

	const addLike = async () => {
		try {
			const response = await fetch('/api/like', { method: 'POST' })
			if (!response.ok) {
				throw new Error('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
			}
			const data = (await response.json()) as { isLike: boolean; count: number }
			setState(data)
		} catch (error) {
			if (error instanceof Error) {
				setError(error.message)
			}
		}
	}

	const removeLike = async () => {
		const response = await fetch('/api/like', { method: 'DELETE' })
		const data = (await response.json()) as { isLike: boolean; count: number }
		setState(data)
	}

	const handleClick = () => {
		startTransition(async () => {
			const nextIsLike = !optimisticState.isLike
			toggleOptimisticIsLike(nextIsLike)

			if (nextIsLike === true) {
				await addLike()
			} else {
				await removeLike()
			}
		})
	}

	const heartIcon = optimisticState.isLike ? <Heart color="#d04e4e" fill="#d04e4e" size={80} /> : <Heart color="#d04e4e" size={80} />

	return (
		<button type="button" className="flex flex-col gap-2 justify-center items-center" onClick={handleClick}>
			{heartIcon}
			<span className="text-4xl text-center text-slate-600 font-semibold">{optimisticState.count}</span>
			{isPending && <div className="text-2xl text-center text-slate-600">loading...</div>}
			{error && <div className="text-2xl text-center text-red-600">{error}</div>}
		</button>
	)
}
```
</details>

### ìš”ì•½

- `useOptimistic` í›…ì€ ë¹„ë™ê¸° ì‘ì—…ì´ ì§„í–‰ ì¤‘ì¼ ë•Œ ë‹¤ë¥¸ ìƒíƒœë¥¼ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
- ë¹„ë™ê¸° ì‘ì—…ì´ë€ React form action ë˜ëŠ”, startTransitionì˜ ì¸ìë¡œ ì „ë‹¬ë˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
- ë¹„ë™ê¸° ì‘ì—…ì˜ í˜¸ì¶œì´ ì™„ë£Œë˜ê³ , `useOptimistic`ì˜ ì´ˆê¸° ìƒíƒœê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ì„ ê²½ìš° `useOptimistic` í›…ì´ ë°˜í™˜í•˜ëŠ” ë‚™ê´€ì ì¸ ìƒíƒœëŠ” ë‹¤ì‹œ ì´ì „ ê°’(ì´ˆê¸° ìƒíƒœ)ë¡œ ë˜ëŒì•„ê°‘ë‹ˆë‹¤.

ì˜ˆì œ ì½”ë“œëŠ” [ì €ì¥ì†Œ](https://github.com/kyh196201/react-useOptimistic-example)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ì°¸ê³ 

- https://medium.com/@kyledeguzmanx/what-are-optimistic-updates-483662c3e171
- [https://velog.io/@kimkanu/React-í›…-useOptimistic](https://velog.io/@kimkanu/React-%ED%9B%85-useOptimistic)
- [https://velog.io/@jhjung3/Optimistic-Updates-êµ¬í˜„í•˜ê¸°-with-ë¦¬ì•¡íŠ¸-ì¿¼ë¦¬](https://velog.io/@jhjung3/Optimistic-Updates-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-with-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%BF%BC%EB%A6%AC)